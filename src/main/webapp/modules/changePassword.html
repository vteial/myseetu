<change-password>

    <header class="header-bar">
        <button class="btn pull-left icon icon-arrow-back"
                data-navigation="$previous-page"></button>
        <div class="center">
            <h1 class="title">{ moduleName }</h1>
        </div>
    </header>

    <div class="content">
        <div class="padded-full">
            <ul class="list" if={ (message != null) }>
                <li class="danger text-center">{ message }</li>
            </ul>
            <div class="input-wrapper">
                <label class="floating-label" for="userCurrentPassword">Current Password</label>
                <input class="with-label" type="password" required
                       id="userCurrentPassword" onblur="{ validateCurrentPassword }">
                <div class="danger-text" if={(userCurrentPasswordMessage != null) }>{ userCurrentPasswordMessage }</div>
            </div>
            <div class="input-wrapper">
                <label class="floating-label" for="userNewPassword">New Password</label>
                <input class="with-label" type="password" required
                       id="userNewPassword" onblur="{ validateNewPassword }">
                <div class="danger-text" if={(userNewPasswordMessage != null) }>{ userNewPasswordMessage }</div>
            </div>
            <div class="input-wrapper">
                <label class="floating-label" for="userRetypeNewPassword">Retype New Password</label>
                <input class="with-label" type="password" required
                       id="userRetypeNewPassword" onblur="{ validateRetypeNewPassword }">
                <div class="danger-text" if={(userRetypeNewPasswordMessage != null) }>{ userRetypeNewPasswordMessage }</div>
            </div>
            <div class="padded-top text-center">
                <button class="btn pull-left" onclick="{ reset }">Reset</button>
                <button class="btn primary pull-right" onclick="{ changePassword }">Save</button>
            </div>
        </div>
    </div>

    <script>
        var self = this, moduleId = 'profile', moduleName = 'Profile'
        this.moduleName = moduleName

        var user = null;

        this.on('close', function (self) {
            console.log(moduleId + ' close started...')
            //self.reset()
            self.close()
            console.log(moduleId + ' close finished...')
        });

        this.on('mount', function () {
            console.log(moduleId + ' mount started...')
            self.reset()
            console.log(moduleId + ' mount finished...')
        });

        reset() {
            this.userCurrentPassword.value = ''
            this.userCurrentPasswordMessage = null

            this.userNewPassword.value = ''
            this.userNewPasswordMessage = null

            this.userRetypeNewPassword.value = ''
            this.userRetypeNewPasswordMessage = null
        }

        function successSave(res) {
            if(res.type === 0) {
                self.reset()
                phonon.notif(res.message, 2000, false);
            } else {
                self.message = res.message
                phonon.notif(res.message, 3000, false);
            }
            self.update()
        }

        function failSave(res) {
            self.message = res.message
            self.update()
            phonon.notif(res.message, 3000, false);
        }

        changePassword() {
            this.message = null
            this.update()

            if(!is.all.null([this.userCurrentPasswordMessage, this.userNewPasswordMessage, this.userRetypeNewPasswordMessage])) {
                this.message = 'Fix the issues on highlighted fields...'
                this.update()
                return
            }

            var user = {
                currentPassword : this.userCurrentPassword.value,
                newPassword : this.userNewPassword.value,
                retypeNewPassword : this.userRetypeNewPassword.value
            }

            if(user.newPassword != user.retypeNewPassword) {
                this.message = 'Password and Retype Password should be matched...'
                this.update()
                phonon.notif(this.message, 3000, false)
                return
            }

            sessionService.changePassword(user, successSave, failSave)
        }

        validateCurrentPassword() {
            var s = this.userCurrentPassword.value
            if(is.empty(s)) {
                this.userCurrentPasswordMessage = 'Should be valid password'
                this.update()
                return
            }
            s = _.trim(s)
            if(s.length < 5) {
                this.userCurrentPasswordMessage = 'Should be minimum 5 characters long'
                this.update()
                return
            }
            this.userCurrentPasswordMessage = null
            this.update()
        }

        validateNewPassword() {
            var s = this.userNewPassword.value
            if(is.empty(s)) {
                this.userNewPasswordMessage = 'Should be valid password'
                this.update()
                return
            }
            s = _.trim(s)
            if(s.length < 5) {
                this.userNewPasswordMessage = 'Should be minimum 5 characters long'
                this.update()
                return
            }
            this.userNewPasswordMessage = null
            this.update()
        }

        validateRetypeNewPassword() {
            var s = this.userRetypeNewPassword.value
            if(is.empty(s)) {
                this.userRetypeNewPasswordMessage = 'Should be valid password'
                this.update()
                return
            }
            s = _.trim(s)
            if(s.length < 5) {
                this.userRetypeNewPasswordMessage = 'Should be minimum 5 characters long'
                this.update()
                return
            }
            this.userRetypeNewPasswordMessage = null
            this.update()
        }

    </script>

</change-password>