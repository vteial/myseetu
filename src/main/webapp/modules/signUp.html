<sign-up>

    <header class="header-bar">
        <button class="btn pull-left icon icon-arrow-back"
                data-navigation="$previous-page"></button>
        <div class="center">
            <h1 class="title">{ moduleName }</h1>
        </div>
    </header>

    <div class="content">
        <div class="padded-full">
            <ul class="list" if={ (message != null) }>
                <li class="danger text-center">{ message }</li>
            </ul>
            <div class="input-wrapper">
                <label class="floating-label" for="userUserId">User (Email) Id</label>
                <input class="with-label" type="email" required
                        id="userUserId" autofocus onblur="{ validateUserUserId }">
                <div class="danger-text" if={(userUserIdMessage != null) }>{ userUserIdMessage }</div>
            </div>
            <div class="input-wrapper">
                <label class="floating-label" for="userPassword">Password</label>
                <input class="with-label" type="password" required
                       id="userPassword" onblur="{ validatePassword }">
                <div class="danger-text" if={(userPasswordMessage != null) }>{ userPasswordMessage }</div>
            </div>
            <div class="input-wrapper">
                <label class="floating-label" for="userRetypePassword">Retype Password</label>
                <input class="with-label" type="password" required
                       id="userRetypePassword" onblur="{ validateRetypePassword }">
                <div class="danger-text" if={(userRetypePasswordMessage != null) }>{ userRetypePasswordMessage }</div>
            </div>
            <div class="input-wrapper">
                <label class="floating-label" for="userFirstName">First Name</label>
                <input class="with-label" type="text" required
                       id="userFirstName" onblur="{ validateUserFirstName }">
                <div class="danger-text" if={(userFirstNameMessage != null) }>{ userFirstNameMessage }</div>
            </div>
            <div class="input-wrapper">
                <label class="floating-label" for="userLastName">Last Name</label>
                <input class="with-label" type="text" required
                       id="userLastName" onblur="{ validateUserLastName }">
                <div class="danger-text" if={(userFirstNameMessage != null) }>{ userLastNameMessage }</div>
            </div>
            <ul class="list">
                <li class="">
                    <label class="checkbox">
                        <input class="" type="checkbox" id="userIagree">
                        I agree the Terms and Conditions
                        <span></span>
                    </label>
                </li>
             </ul>
            <div class="padded-top text-center">
                <button class="btn pull-left" onclick="{ reset }">Reset</button>
                <a href="#!sign-in" id="signIn">Sign In</a>
                <button class="btn primary pull-right" onclick="{ signUp }">Sign Up</button>
            </div>
        </div>
    </div>

    <script>
        var self = this, moduleId = 'sign-up', moduleName = 'Sign Up'
        this.moduleName = moduleName

        this.on('close', function (self) {
            console.log(moduleId + ' close started...')
            self.close()
            console.log(moduleId + ' close finished...')
        });

        this.on('mount', function () {
            console.log(moduleId + ' mount started...')
            this.reset()
            console.log(moduleId + ' mount finished...')
        });

        reset() {
            this.message = null

            this.userUserId.value = ''
            this.userUserIdMessage = null

            this.userPassword.value = ''
            this.userPasswordMessage = null

            this.userRetypePassword.value = ''
            this.userRetypePasswordMessage = null

            this.userFirstName.value = ''
            this.userFirstNameMessage = null

            this.userLastName.value = ''
            this.userLastNameMessage = null

            this.userIagree.checked = false
        }

        function successSignUp(res) {
            if(res.type === 0) {
                var alert = phonon.alert(res.message, 'Success', false, 'Ok')
                alert.on('confirm', function () {
                    self.reset()
                    //phonon.navigator().changePage('sign-in')
                    this.signIn.click()
                })
            } else {
                self.message = res.message
                self.update()
                phonon.notif(res.message, 3000, false);
            }
        }

        function failSignUp(res) {
            self.message = res.message
            self.update()
            phonon.notif(res.message, 3000, false)
        }

        signUp() {
            this.message = null
            this.update()

            if(!is.all.null([this.userUserIdMessage, this.userPasswordMessage, this.userFirstNameMessage, this.userLastNameMessage])) {
                this.message = 'Fix the issues on highlighted fields...'
                this.update()
                return
            }

            var user = {
                userId : this.userUserId.value,
                password : this.userPassword.value,
                retypePassword : this.userRetypePassword.value,
                firstName : this.userFirstName.value,
                lastName : this.userLastName.value
            }

            if(user.password != user.retypePassword) {
                this.message = 'Password and Retype Password should be matched...'
                this.update()
                phonon.notif(this.message, 3000, false)
                return
            }

            if( !this.userIagree.checked) {
                this.message = 'You should agree the terms and conditions...'
                this.update()
                phonon.notif(this.message, 3000, false)
                return
            }

            sessionService.signUp(user, successSignUp, failSignUp)
        }

        validateUserUserId() {
            var s = this.userUserId.value
            if(!is.email(s)) {
                this.userUserIdMessage = 'Should be valid email id'
            } else {
                this.userUserIdMessage = null
            }
            //this.userUserId = s.toLowerCase()
            this.update()
        }

        validatePassword() {
            var s = this.userPassword.value
            if(is.empty(s)) {
                this.userPasswordMessage = 'Should be valid password'
                this.update()
                return
            }
            s = _.trim(s)
            if(s.length < 5) {
                this.userPasswordMessage = 'Should be minimum 5 characters long'
                this.update()
                return
            }
            this.userPasswordMessage = null
            this.update()
        }

        validateRetypePassword() {
            var s = this.userRetypePassword.value
            if(is.empty(s)) {
                this.userRetypePasswordMessage = 'Should be valid password'
                this.update()
                return
            }
            s = _.trim(s)
            if(s.length < 5) {
                this.userRetypePasswordMessage = 'Should be minimum 5 characters long'
                this.update()
                return
            }
            this.userRetypePasswordMessage = null
            this.update()
        }

        validateUserFirstName() {
            var s = this.userFirstName.value
            if(is.empty(s)) {
                this.userFirstNameMessage = 'Should be valid name'
                this.update()
                return
            }
            s = _.trim(s)
            if(s.length == 0) {
                this.userFirstNameMessage = 'Should be valid name'
                this.update()
                return
            }
            if(s.length < 2 && s.length > 20) {
                this.userFirstNameMessage = 'Should be minimum 2 and not more than 20 characters long'
                this.update()
                return
            }

            this.userFirstName.value = _.capitalize(s)
            this.userFirstNameMessage = null
            this.update()
        }

        validateUserLastName() {
            var s = this.userLastName.value
            if(is.empty(s)) {
                this.userLastNameMessage = 'Should be valid name'
                this.update()
                return
            }
            s = _.trim(s)
            if(s.length == 0) {
                this.userLastNameMessage = 'Should be valid name'
                this.update()
                return
            }
            if(s.length < 2 && s.length > 20) {
                this.userLastNameMessage = 'Should be minimum 2 and not more than 20 characters long'
                this.update()
                return
            }

            this.userLastName.value = _.capitalize(s)
            this.userLastNameMessage = null
            this.update()
        }

    </script>

</sign-up>